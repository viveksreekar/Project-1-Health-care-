<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Periodic Table Game</title>
    <style>
        /* General Styles */
        :root {
            --bg-color: #f0f2f5;
            --container-bg: #ffffff;
            --sidebar-bg: #e9ecef;
            --border-color: #d1d9e6;
            --shadow-light: #ffffff;
            --shadow-dark: #b8c6dc;
            --text-color: #333;
            --accent-color: #4a69bd;
            --correct-color: #2ecc71;
            --incorrect-color: #e74c3c;
            --gemini-purple: #8e44ad;

            /* Element Categories Colors */
            --alkali-metal: #ff6b6b;
            --alkaline-earth-metal: #ff9f43;
            --lanthanide: #feca57;
            --actinide: #ff9ff3;
            --transition-metal: #48dbfb;
            --post-transition-metal: #1dd1a1;
            --metalloid: #54a0ff;
            --polyatomic-nonmetal: #5f27cd;
            --diatomic-nonmetal: #ff6b6b;
            --noble-gas: #c8d6e5;
            --unknown: #8395a7;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }
        
        #game-wrapper {
            display: flex;
        }

        /* Sidebar */
        #sidebar {
            width: 250px;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background-color: var(--sidebar-bg);
            padding: 20px;
            box-shadow: 4px 0px 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            z-index: 100;
        }
        
        #sidebar h2 {
            color: var(--accent-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 5px;
            margin-top: 0;
        }
        
        #score-container {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
            background: var(--container-bg);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        #achievements-list {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
        }
        
        .achievement {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
            opacity: 0.5;
            transition: all 0.3s ease;
        }
        
        .achievement.unlocked {
            opacity: 1;
            background-color: var(--correct-color);
            color: white;
            font-weight: bold;
        }
        
        .achievement h4 { margin: 0 0 5px 0; }
        .achievement p { margin: 0; font-size: 0.85em; }

        /* Main Content Area */
        .main-content {
            margin-left: 270px; /* Sidebar width + padding */
            padding: 20px;
            width: calc(100% - 270px);
        }

        /* Main Container */
        .container {
            width: 100%;
            max-width: 1200px;
            background: var(--container-bg);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
            text-align: center;
        }

        h1 { color: var(--accent-color); margin-bottom: 20px; }
        .instructions { margin-bottom: 25px; color: #555; font-size: 1.1em; max-width: 800px; margin-left: auto; margin-right: auto; }
        
        /* Periodic Table Grid */
        #periodic-table-area {
            display: grid;
            grid-template-columns: 30px repeat(18, minmax(50px, 1fr));
            grid-template-rows: 30px repeat(10, minmax(50px, 1fr));
            gap: 4px;
            margin-bottom: 25px;
            min-width: 950px;
        }
        #periodic-table-container {
            grid-column: 2 / -1;
            grid-row: 2 / -1;
            display: contents;
        }
        #periodic-table-grid {
            display: contents;
        }
        
        .grid-label {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--accent-color);
        }
        .group-label { grid-row: 1; }
        .period-label { grid-column: 1; }

        .drop-zone { background-color: var(--bg-color); border: 1px solid var(--border-color); border-radius: 5px; display: flex; justify-content: center; align-items: center; font-size: 10px; color: #aaa; position: relative; transition: all 0.2s ease; }
        .drop-zone.over { border-color: var(--accent-color); transform: scale(1.05); background-color: #e9f5ff; }
        .drop-zone.correct-drop { color: #fff; border: none; cursor: default; }
        .drop-zone.correct-drop .element-symbol { font-size: 16px; font-weight: bold; }
        .drop-zone.correct-drop .element-number { font-size: 9px; position: absolute; top: 3px; left: 3px; }
        .fun-fact-btn {
            position: absolute;
            bottom: 2px;
            right: 2px;
            cursor: pointer;
            font-size: 14px;
            line-height: 1;
            filter: grayscale(1);
            transition: all 0.2s ease;
        }
        .fun-fact-btn:hover {
            transform: scale(1.3);
            filter: grayscale(0);
        }

        /* Element Bank */
        #element-bank-container { padding: 15px; background: #e9ecef; border-radius: 10px; margin-bottom: 20px; }
        #element-bank { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; min-height: 60px; }
        .draggable-element { height: 55px; width: 55px; background-color: var(--container-bg); border: 1px solid var(--border-color); border-radius: 5px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: grab; user-select: none; box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light); transition: transform 0.2s, box-shadow 0.2s; }
        .draggable-element:hover { transform: scale(1.1); }
        .draggable-element.dragging { opacity: 0.4; cursor: grabbing; box-shadow: none; }
        .element-symbol { font-size: 18px; font-weight: bold; }
        .element-name-small { font-size: 9px; }
        .hidden { display: none; }

        /* Color Coding by Category */
        .alkali-metal { background-color: var(--alkali-metal); } .alkaline-earth-metal { background-color: var(--alkaline-earth-metal); } .lanthanide { background-color: var(--lanthanide); } .actinide { background-color: var(--actinide); } .transition-metal { background-color: var(--transition-metal); } .post-transition-metal { background-color: var(--post-transition-metal); } .metalloid { background-color: var(--metalloid); } .polyatomic-nonmetal, .diatomic-nonmetal { background-color: var(--polyatomic-nonmetal); color: white; } .noble-gas { background-color: var(--noble-gas); } .unknown { background-color: var(--unknown); color: white; }

        /* Modals */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s; }
        .modal.show { opacity: 1; visibility: visible; }
        .modal-container { background: var(--container-bg); padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; text-align: center; transform: scale(0.9); transition: transform 0.3s ease; position: relative; }
        .modal.show .modal-container { transform: scale(1); }
        #quiz-options { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        .quiz-option { padding: 12px 22px; background-color: var(--container-bg); border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; box-shadow: 4px 4px 8px var(--shadow-dark); transition: all 0.2s ease-in-out; }
        .quiz-option:hover { transform: translateY(-2px); box-shadow: 6px 6px 12px var(--shadow-dark); }
        #quiz-feedback { margin-top: 20px; font-weight: bold; min-height: 24px; font-size: 1.1em; }
        #chem-lab-selections { display: flex; justify-content: center; align-items: center; gap: 20px; margin: 20px 0; }
        #chem-lab-result { font-size: 1.1em; font-weight: bold; min-height: 60px; background: #f8f9fa; border-radius: 8px; padding: 15px; text-align: left; line-height: 1.5; }
        
        /* Loading Spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid var(--accent-color);
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Screen Flash & Notifications */
        #screen-flash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; pointer-events: none; opacity: 0; transition: opacity 0.5s ease; }
        #screen-flash.flash-correct { background-color: var(--correct-color); }
        #screen-flash.flash-incorrect { background-color: var(--incorrect-color); }
        #achievement-unlocked-notification { position: fixed; top: 20px; right: -300px; background-color: var(--accent-color); color: white; padding: 15px 25px; border-radius: 10px; z-index: 3000; transition: right 0.5s ease-in-out; }
        #achievement-unlocked-notification.show { right: 20px; }

        /* Buttons */
        .action-button { padding: 12px 25px; font-size: 1em; font-weight: bold; color: #fff; background-color: var(--accent-color); border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.2s; margin: 10px; }
        .action-button:hover { background-color: #3b5998; }
        .action-button.gemini-btn { background: linear-gradient(45deg, var(--gemini-purple), var(--accent-color)); }
        .action-button:disabled { background: #aaa; cursor: not-allowed; }
        .modal-close-btn { position: absolute; top: 10px; right: 15px; font-size: 24px; border: none; background: none; cursor: pointer; }

        @media (max-width: 1200px) {
            .main-content { margin-left: 0; width: 100%; }
            #sidebar { position: relative; width: 100%; height: auto; box-shadow: none; margin-bottom: 20px; }
            #game-wrapper { flex-direction: column; }
        }
        @media (max-width: 768px) {
            #periodic-table-area { grid-template-columns: 20px repeat(18, 40px); grid-template-rows: 20px repeat(10, 40px); }
            .draggable-element { width: 45px; height: 45px; }
            .element-symbol { font-size: 14px; }
            .element-name-small { font-size: 7px; }
            .drop-zone.correct-drop .element-symbol { font-size: 14px; }
            .drop-zone.correct-drop .element-number { font-size: 7px; }
        }
    </style>
</head>
<body>
    <div id="game-wrapper">
        <div id="sidebar">
            <h2>Game Stats</h2>
            <div id="score-container">Score: <span id="score">0</span></div>
            <h2>Achievements</h2>
            <ul id="achievements-list"></ul>
            <h2>Chem Lab</h2>
            <p style="font-size: 0.9em; margin-top: 0;">Combine placed elements to discover compounds!</p>
            <button id="open-chem-lab-btn" class="action-button">Open Lab</button>
        </div>

        <div class="main-content">
            <div class="container">
                <h1>AI-Powered Periodic Table Game</h1>
                <p class="instructions">
                    Drag elements to their correct spot. Correctly placed elements get a ✨ icon - click it for a fun fact!
                    Use the Chem Lab to combine elements and see what they make.
                </p>

                <div id="periodic-table-area">
                    <div id="periodic-table-container">
                        <div id="periodic-table-grid"></div>
                    </div>
                </div>

                <div id="element-bank-container">
                    <h3>Element Bank</h3>
                    <div id="element-bank"></div>
                    <button id="new-batch-btn" class="action-button">New Batch</button>
                    <button id="reset-game-btn" class="action-button">Reset Full Game</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="mistake-quiz-modal" class="modal">
        <div id="quiz-container" class="modal-container">
            <h2 id="quiz-title">Quick Question!</h2>
            <div id="quiz-question"></div>
            <div id="quiz-options"></div>
            <div id="quiz-feedback"></div>
        </div>
    </div>
    
    <div id="chem-lab-modal" class="modal">
        <div class="modal-container">
            <button class="modal-close-btn" id="close-chem-lab-btn">&times;</button>
            <h2>Chemistry Lab</h2>
            <p>Select two placed elements to see if they react.</p>
            <div id="chem-lab-selections">
                <select id="chem-lab-el1"></select>
                <span>+</span>
                <select id="chem-lab-el2"></select>
            </div>
            <button id="combine-btn" class="action-button gemini-btn">✨ Combine</button>
            <div id="chem-lab-result"></div>
        </div>
    </div>

    <div id="fun-fact-modal" class="modal">
        <div class="modal-container">
            <button class="modal-close-btn" id="close-fun-fact-btn">&times;</button>
            <h2 id="fun-fact-title"></h2>
            <p id="fun-fact-content" style="font-size: 1.2em; line-height: 1.6;"></p>
        </div>
    </div>

    <!-- Overlays -->
    <div id="screen-flash"></div>
    <div id="achievement-unlocked-notification"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA: All 118 Elements (abbreviated for brevity) ---
            const elementsData = [
                { name: 'Hydrogen', symbol: 'H', atomicNumber: 1, group: 1, period: 1, category: 'diatomic-nonmetal' }, { name: 'Helium', symbol: 'He', atomicNumber: 2, group: 18, period: 1, category: 'noble-gas' }, { name: 'Lithium', symbol: 'Li', atomicNumber: 3, group: 1, period: 2, category: 'alkali-metal' }, { name: 'Beryllium', symbol: 'Be', atomicNumber: 4, group: 2, period: 2, category: 'alkaline-earth-metal' }, { name: 'Boron', symbol: 'B', atomicNumber: 5, group: 13, period: 2, category: 'metalloid' }, { name: 'Carbon', symbol: 'C', atomicNumber: 6, group: 14, period: 2, category: 'polyatomic-nonmetal' }, { name: 'Nitrogen', symbol: 'N', atomicNumber: 7, group: 15, period: 2, category: 'diatomic-nonmetal' }, { name: 'Oxygen', symbol: 'O', atomicNumber: 8, group: 16, period: 2, category: 'diatomic-nonmetal' }, { name: 'Fluorine', symbol: 'F', atomicNumber: 9, group: 17, period: 2, category: 'diatomic-nonmetal' }, { name: 'Neon', symbol: 'Ne', atomicNumber: 10, group: 18, period: 2, category: 'noble-gas' }, { name: 'Sodium', symbol: 'Na', atomicNumber: 11, group: 1, period: 3, category: 'alkali-metal' }, { name: 'Magnesium', symbol: 'Mg', atomicNumber: 12, group: 2, period: 3, category: 'alkaline-earth-metal' }, { name: 'Aluminium', symbol: 'Al', atomicNumber: 13, group: 13, period: 3, category: 'post-transition-metal' }, { name: 'Silicon', symbol: 'Si', atomicNumber: 14, group: 14, period: 3, category: 'metalloid' }, { name: 'Phosphorus', symbol: 'P', atomicNumber: 15, group: 15, period: 3, category: 'polyatomic-nonmetal' }, { name: 'Sulfur', symbol: 'S', atomicNumber: 16, group: 16, period: 3, category: 'polyatomic-nonmetal' }, { name: 'Chlorine', symbol: 'Cl', atomicNumber: 17, group: 17, period: 3, category: 'diatomic-nonmetal' }, { name: 'Argon', symbol: 'Ar', atomicNumber: 18, group: 18, period: 3, category: 'noble-gas' }, { name: 'Potassium', symbol: 'K', atomicNumber: 19, group: 1, period: 4, category: 'alkali-metal' }, { name: 'Calcium', symbol: 'Ca', atomicNumber: 20, group: 2, period: 4, category: 'alkaline-earth-metal' }, // ... and so on for all 118 elements
                // Full data is assumed to be here from previous version
            ];
            // A more complete list for better functionality
            const fullElementsData = [
                { name: 'Hydrogen', symbol: 'H', atomicNumber: 1, group: 1, period: 1, category: 'diatomic-nonmetal' }, { name: 'Helium', symbol: 'He', atomicNumber: 2, group: 18, period: 1, category: 'noble-gas' }, { name: 'Lithium', symbol: 'Li', atomicNumber: 3, group: 1, period: 2, category: 'alkali-metal' }, { name: 'Beryllium', symbol: 'Be', atomicNumber: 4, group: 2, period: 2, category: 'alkaline-earth-metal' }, { name: 'Boron', symbol: 'B', atomicNumber: 5, group: 13, period: 2, category: 'metalloid' }, { name: 'Carbon', symbol: 'C', atomicNumber: 6, group: 14, period: 2, category: 'polyatomic-nonmetal' }, { name: 'Nitrogen', symbol: 'N', atomicNumber: 7, group: 15, period: 2, category: 'diatomic-nonmetal' }, { name: 'Oxygen', symbol: 'O', atomicNumber: 8, group: 16, period: 2, category: 'diatomic-nonmetal' }, { name: 'Fluorine', symbol: 'F', atomicNumber: 9, group: 17, period: 2, category: 'diatomic-nonmetal' }, { name: 'Neon', symbol: 'Ne', atomicNumber: 10, group: 18, period: 2, category: 'noble-gas' }, { name: 'Sodium', symbol: 'Na', atomicNumber: 11, group: 1, period: 3, category: 'alkali-metal' }, { name: 'Magnesium', symbol: 'Mg', atomicNumber: 12, group: 2, period: 3, category: 'alkaline-earth-metal' }, { name: 'Aluminium', symbol: 'Al', atomicNumber: 13, group: 13, period: 3, category: 'post-transition-metal' }, { name: 'Silicon', symbol: 'Si', atomicNumber: 14, group: 14, period: 3, category: 'metalloid' }, { name: 'Phosphorus', symbol: 'P', atomicNumber: 15, group: 15, period: 3, category: 'polyatomic-nonmetal' }, { name: 'Sulfur', symbol: 'S', atomicNumber: 16, group: 16, period: 3, category: 'polyatomic-nonmetal' }, { name: 'Chlorine', symbol: 'Cl', atomicNumber: 17, group: 17, period: 3, category: 'diatomic-nonmetal' }, { name: 'Argon', symbol: 'Ar', atomicNumber: 18, group: 18, period: 3, category: 'noble-gas' }, { name: 'Potassium', symbol: 'K', atomicNumber: 19, group: 1, period: 4, category: 'alkali-metal' }, { name: 'Calcium', symbol: 'Ca', atomicNumber: 20, group: 2, period: 4, category: 'alkaline-earth-metal' }, { name: 'Scandium', symbol: 'Sc', atomicNumber: 21, group: 3, period: 4, category: 'transition-metal' }, { name: 'Titanium', symbol: 'Ti', atomicNumber: 22, group: 4, period: 4, category: 'transition-metal' }, { name: 'Vanadium', symbol: 'V', atomicNumber: 23, group: 5, period: 4, category: 'transition-metal' }, { name: 'Chromium', symbol: 'Cr', atomicNumber: 24, group: 6, period: 4, category: 'transition-metal' }, { name: 'Manganese', symbol: 'Mn', atomicNumber: 25, group: 7, period: 4, category: 'transition-metal' }, { name: 'Iron', symbol: 'Fe', atomicNumber: 26, group: 8, period: 4, category: 'transition-metal' }, { name: 'Cobalt', symbol: 'Co', atomicNumber: 27, group: 9, period: 4, category: 'transition-metal' }, { name: 'Nickel', symbol: 'Ni', atomicNumber: 28, group: 10, period: 4, category: 'transition-metal' }, { name: 'Copper', symbol: 'Cu', atomicNumber: 29, group: 11, period: 4, category: 'transition-metal' }, { name: 'Zinc', symbol: 'Zn', atomicNumber: 30, group: 12, period: 4, category: 'transition-metal' }, { name: 'Gallium', symbol: 'Ga', atomicNumber: 31, group: 13, period: 4, category: 'post-transition-metal' }, { name: 'Germanium', symbol: 'Ge', atomicNumber: 32, group: 14, period: 4, category: 'metalloid' }, { name: 'Arsenic', symbol: 'As', atomicNumber: 33, group: 15, period: 4, category: 'metalloid' }, { name: 'Selenium', symbol: 'Se', atomicNumber: 34, group: 16, period: 4, category: 'polyatomic-nonmetal' }, { name: 'Bromine', symbol: 'Br', atomicNumber: 35, group: 17, period: 4, category: 'diatomic-nonmetal' }, { name: 'Krypton', symbol: 'Kr', atomicNumber: 36, group: 18, period: 4, category: 'noble-gas' }, { name: 'Rubidium', symbol: 'Rb', atomicNumber: 37, group: 1, period: 5, category: 'alkali-metal' }, { name: 'Strontium', symbol: 'Sr', atomicNumber: 38, group: 2, period: 5, category: 'alkaline-earth-metal' }, { name: 'Yttrium', symbol: 'Y', atomicNumber: 39, group: 3, period: 5, category: 'transition-metal' }, { name: 'Zirconium', symbol: 'Zr', atomicNumber: 40, group: 4, period: 5, category: 'transition-metal' }, { name: 'Niobium', symbol: 'Nb', atomicNumber: 41, group: 5, period: 5, category: 'transition-metal' }, { name: 'Molybdenum', symbol: 'Mo', atomicNumber: 42, group: 6, period: 5, category: 'transition-metal' }, { name: 'Technetium', symbol: 'Tc', atomicNumber: 43, group: 7, period: 5, category: 'transition-metal' }, { name: 'Ruthenium', symbol: 'Ru', atomicNumber: 44, group: 8, period: 5, category: 'transition-metal' }, { name: 'Rhodium', symbol: 'Rh', atomicNumber: 45, group: 9, period: 5, category: 'transition-metal' }, { name: 'Palladium', symbol: 'Pd', atomicNumber: 46, group: 10, period: 5, category: 'transition-metal' }, { name: 'Silver', symbol: 'Ag', atomicNumber: 47, group: 11, period: 5, category: 'transition-metal' }, { name: 'Cadmium', symbol: 'Cd', atomicNumber: 48, group: 12, period: 5, category: 'transition-metal' }, { name: 'Indium', symbol: 'In', atomicNumber: 49, group: 13, period: 5, category: 'post-transition-metal' }, { name: 'Tin', symbol: 'Sn', atomicNumber: 50, group: 14, period: 5, category: 'post-transition-metal' }, { name: 'Antimony', symbol: 'Sb', atomicNumber: 51, group: 15, period: 5, category: 'metalloid' }, { name: 'Tellurium', symbol: 'Te', atomicNumber: 52, group: 16, period: 5, category: 'metalloid' }, { name: 'Iodine', symbol: 'I', atomicNumber: 53, group: 17, period: 5, category: 'diatomic-nonmetal' }, { name: 'Xenon', symbol: 'Xe', atomicNumber: 54, group: 18, period: 5, category: 'noble-gas' }, { name: 'Caesium', symbol: 'Cs', atomicNumber: 55, group: 1, period: 6, category: 'alkali-metal' }, { name: 'Barium', symbol: 'Ba', atomicNumber: 56, group: 2, period: 6, category: 'alkaline-earth-metal' }, { name: 'Lanthanum', symbol: 'La', atomicNumber: 57, group: 3, period: 9, category: 'lanthanide' }, { name: 'Cerium', symbol: 'Ce', atomicNumber: 58, group: 4, period: 9, category: 'lanthanide' }, { name: 'Praseodymium', symbol: 'Pr', atomicNumber: 59, group: 5, period: 9, category: 'lanthanide' }, { name: 'Neodymium', symbol: 'Nd', atomicNumber: 60, group: 6, period: 9, category: 'lanthanide' }, { name: 'Promethium', symbol: 'Pm', atomicNumber: 61, group: 7, period: 9, category: 'lanthanide' }, { name: 'Samarium', symbol: 'Sm', atomicNumber: 62, group: 8, period: 9, category: 'lanthanide' }, { name: 'Europium', symbol: 'Eu', atomicNumber: 63, group: 9, period: 9, category: 'lanthanide' }, { name: 'Gadolinium', symbol: 'Gd', atomicNumber: 64, group: 10, period: 9, category: 'lanthanide' }, { name: 'Terbium', symbol: 'Tb', atomicNumber: 65, group: 11, period: 9, category: 'lanthanide' }, { name: 'Dysprosium', symbol: 'Dy', atomicNumber: 66, group: 12, period: 9, category: 'lanthanide' }, { name: 'Holmium', symbol: 'Ho', atomicNumber: 67, group: 13, period: 9, category: 'lanthanide' }, { name: 'Erbium', symbol: 'Er', atomicNumber: 68, group: 14, period: 9, category: 'lanthanide' }, { name: 'Thulium', symbol: 'Tm', atomicNumber: 69, group: 15, period: 9, category: 'lanthanide' }, { name: 'Ytterbium', symbol: 'Yb', atomicNumber: 70, group: 16, period: 9, category: 'lanthanide' }, { name: 'Lutetium', symbol: 'Lu', atomicNumber: 71, group: 17, period: 9, category: 'lanthanide' }, { name: 'Hafnium', symbol: 'Hf', atomicNumber: 72, group: 4, period: 6, category: 'transition-metal' }, { name: 'Tantalum', symbol: 'Ta', atomicNumber: 73, group: 5, period: 6, category: 'transition-metal' }, { name: 'Tungsten', symbol: 'W', atomicNumber: 74, group: 6, period: 6, category: 'transition-metal' }, { name: 'Rhenium', symbol: 'Re', atomicNumber: 75, group: 7, period: 6, category: 'transition-metal' }, { name: 'Osmium', symbol: 'Os', atomicNumber: 76, group: 8, period: 6, category: 'transition-metal' }, { name: 'Iridium', symbol: 'Ir', atomicNumber: 77, group: 9, period: 6, category: 'transition-metal' }, { name: 'Platinum', symbol: 'Pt', atomicNumber: 78, group: 10, period: 6, category: 'transition-metal' }, { name: 'Gold', symbol: 'Au', atomicNumber: 79, group: 11, period: 6, category: 'transition-metal' }, { name: 'Mercury', symbol: 'Hg', atomicNumber: 80, group: 12, period: 6, category: 'transition-metal' }, { name: 'Thallium', symbol: 'Tl', atomicNumber: 81, group: 13, period: 6, category: 'post-transition-metal' }, { name: 'Lead', symbol: 'Pb', atomicNumber: 82, group: 14, period: 6, category: 'post-transition-metal' }, { name: 'Bismuth', symbol: 'Bi', atomicNumber: 83, group: 15, period: 6, category: 'post-transition-metal' }, { name: 'Polonium', symbol: 'Po', atomicNumber: 84, group: 16, period: 6, category: 'post-transition-metal' }, { name: 'Astatine', symbol: 'At', atomicNumber: 85, group: 17, period: 6, category: 'metalloid' }, { name: 'Radon', symbol: 'Rn', atomicNumber: 86, group: 18, period: 6, category: 'noble-gas' }, { name: 'Francium', symbol: 'Fr', atomicNumber: 87, group: 1, period: 7, category: 'alkali-metal' }, { name: 'Radium', symbol: 'Ra', atomicNumber: 88, group: 2, period: 7, category: 'alkaline-earth-metal' }, { name: 'Actinium', symbol: 'Ac', atomicNumber: 89, group: 3, period: 10, category: 'actinide' }, { name: 'Thorium', symbol: 'Th', atomicNumber: 90, group: 4, period: 10, category: 'actinide' }, { name: 'Protactinium', symbol: 'Pa', atomicNumber: 91, group: 5, period: 10, category: 'actinide' }, { name: 'Uranium', symbol: 'U', atomicNumber: 92, group: 6, period: 10, category: 'actinide' }, { name: 'Neptunium', symbol: 'Np', atomicNumber: 93, group: 7, period: 10, category: 'actinide' }, { name: 'Plutonium', symbol: 'Pu', atomicNumber: 94, group: 8, period: 10, category: 'actinide' }, { name: 'Americium', symbol: 'Am', atomicNumber: 95, group: 9, period: 10, category: 'actinide' }, { name: 'Curium', symbol: 'Cm', atomicNumber: 96, group: 10, period: 10, category: 'actinide' }, { name: 'Berkelium', symbol: 'Bk', atomicNumber: 97, group: 11, period: 10, category: 'actinide' }, { name: 'Californium', symbol: 'Cf', atomicNumber: 98, group: 12, period: 10, category: 'actinide' }, { name: 'Einsteinium', symbol: 'Es', atomicNumber: 99, group: 13, period: 10, category: 'actinide' }, { name: 'Fermium', symbol: 'Fm', atomicNumber: 100, group: 14, period: 10, category: 'actinide' }, { name: 'Mendelevium', symbol: 'Md', atomicNumber: 101, group: 15, period: 10, category: 'actinide' }, { name: 'Nobelium', symbol: 'No', atomicNumber: 102, group: 16, period: 10, category: 'actinide' }, { name: 'Lawrencium', symbol: 'Lr', atomicNumber: 103, group: 17, period: 10, category: 'actinide' }, { name: 'Rutherfordium', symbol: 'Rf', atomicNumber: 104, group: 4, period: 7, category: 'transition-metal' }, { name: 'Dubnium', symbol: 'Db', atomicNumber: 105, group: 5, period: 7, category: 'transition-metal' }, { name: 'Seaborgium', symbol: 'Sg', atomicNumber: 106, group: 6, period: 7, category: 'transition-metal' }, { name: 'Bohrium', symbol: 'Bh', atomicNumber: 107, group: 7, period: 7, category: 'transition-metal' }, { name: 'Hassium', symbol: 'Hs', atomicNumber: 108, group: 8, period: 7, category: 'transition-metal' }, { name: 'Meitnerium', symbol: 'Mt', atomicNumber: 109, group: 9, period: 7, category: 'transition-metal' }, { name: 'Darmstadtium', symbol: 'Ds', atomicNumber: 110, group: 10, period: 7, category: 'transition-metal' }, { name: 'Roentgenium', symbol: 'Rg', atomicNumber: 111, group: 11, period: 7, category: 'transition-metal' }, { name: 'Copernicium', symbol: 'Cn', atomicNumber: 112, group: 12, period: 7, category: 'transition-metal' }, { name: 'Nihonium', symbol: 'Nh', atomicNumber: 113, group: 13, period: 7, category: 'unknown' }, { name: 'Flerovium', symbol: 'Fl', atomicNumber: 114, group: 14, period: 7, category: 'unknown' }, { name: 'Moscovium', symbol: 'Mc', atomicNumber: 115, group: 15, period: 7, category: 'unknown' }, { name: 'Livermorium', symbol: 'Lv', atomicNumber: 116, group: 16, period: 7, category: 'unknown' }, { name: 'Tennessine', symbol: 'Ts', atomicNumber: 117, group: 17, period: 7, category: 'unknown' }, { name: 'Oganesson', symbol: 'Og', atomicNumber: 118, group: 18, period: 7, category: 'unknown' },
            ];

            // --- Achievements Data ---
            let achievements = [
                { id: 'first_place', title: 'First Step', description: 'Place your first element correctly.', unlocked: false }, { id: 'batch_complete', title: 'Batch Master', description: 'Complete a full batch of elements.', unlocked: false }, { id: 'alkali_master', title: 'Alkali Apprentice', description: 'Place all Alkali Metals.', unlocked: false, category: 'alkali-metal' }, { id: 'noble_master', title: 'Noble Gaser', description: 'Place all Noble Gases.', unlocked: false, category: 'noble-gas' }, { id: 'score_100', title: 'Centurion', description: 'Reach a score of 100.', unlocked: false }
            ];

            // --- DOM Elements ---
            const grid = document.getElementById('periodic-table-grid');
            const tableArea = document.getElementById('periodic-table-area');
            const bank = document.getElementById('element-bank');
            const newBatchBtn = document.getElementById('new-batch-btn');
            const resetGameBtn = document.getElementById('reset-game-btn');
            const scoreEl = document.getElementById('score');
            const achievementsListEl = document.getElementById('achievements-list');
            const achievementNotificationEl = document.getElementById('achievement-unlocked-notification');
            
            // Modal elements
            const quizModal = document.getElementById('mistake-quiz-modal');
            const chemLabModal = document.getElementById('chem-lab-modal');
            const funFactModal = document.getElementById('fun-fact-modal');
            
            // Chem Lab elements
            const openChemLabBtn = document.getElementById('open-chem-lab-btn');
            const closeChemLabBtn = document.getElementById('close-chem-lab-btn');
            const combineBtn = document.getElementById('combine-btn');
            const chemLabResultEl = document.getElementById('chem-lab-result');

            // Fun Fact elements
            const funFactTitleEl = document.getElementById('fun-fact-title');
            const funFactContentEl = document.getElementById('fun-fact-content');
            const closeFunFactBtn = document.getElementById('close-fun-fact-btn');

            let currentBatch = [];
            let placedElements = new Set();
            let score = 0;

            // --- Gemini API Integration ---
            const API_KEY = ""; // Kept empty as per instructions
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;

            async function callGemini(prompt, isJson = false) {
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                };
                if (isJson) {
                    payload.generationConfig = {
                        responseMimeType: "application/json",
                    };
                }

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.statusText}`);
                    }
                    const data = await response.json();
                    const text = data.candidates[0].content.parts[0].text;
                    return text;
                } catch (error) {
                    console.error("Gemini API call failed:", error);
                    return null;
                }
            }
            
            // --- Game Setup ---
            function setupGame() {
                grid.innerHTML = '';
                tableArea.querySelectorAll('.grid-label').forEach(l => l.remove());
                placedElements.clear();
                score = 0;
                updateScoreDisplay();
                achievements.forEach(a => a.unlocked = false);
                initializeAchievements();
                createTableLabels();

                for (let p = 1; p <= 10; p++) {
                    for (let g = 1; g <= 18; g++) {
                        const el = getElementByPosition(p, g);
                        if (el) {
                           const dropZone = document.createElement('div');
                            dropZone.classList.add('drop-zone');
                            dropZone.style.gridColumn = el.group;
                            dropZone.style.gridRow = el.period;
                            dropZone.dataset.atomicNumber = el.atomicNumber;
                            
                            dropZone.addEventListener('dragover', (e) => e.preventDefault());
                            dropZone.addEventListener('drop', handleDrop);
                            grid.appendChild(dropZone);
                        }
                    }
                }
                generateNewBatch();
            }
            
            function createTableLabels() {
                for (let i = 1; i <= 18; i++) {
                    const label = document.createElement('div');
                    label.textContent = i;
                    label.classList.add('grid-label', 'group-label');
                    label.style.gridColumn = i + 1;
                    tableArea.appendChild(label);
                }
                for (let i = 1; i <= 7; i++) {
                    const label = document.createElement('div');
                    label.textContent = i;
                    label.classList.add('grid-label', 'period-label');
                    label.style.gridRow = i + 1;
                    tableArea.appendChild(label);
                }
            }

            function generateNewBatch() {
                bank.innerHTML = '';
                const unplacedElements = fullElementsData.filter(el => !placedElements.has(el.atomicNumber));
                
                if (unplacedElements.length === 0) {
                    bank.innerHTML = '<h2>Congratulations! You placed all elements!</h2>';
                    return;
                }

                currentBatch = unplacedElements.sort(() => 0.5 - Math.random()).slice(0, 15);

                currentBatch.forEach(el => {
                    const draggable = document.createElement('div');
                    draggable.className = `draggable-element ${el.category}`;
                    draggable.dataset.atomicNumber = el.atomicNumber;
                    draggable.draggable = true;
                    draggable.innerHTML = `<span class="element-symbol">${el.symbol}</span><span class="element-name-small">${el.name}</span>`;
                    draggable.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', e.target.dataset.atomicNumber);
                        setTimeout(() => e.target.classList.add('dragging'), 0);
                    });
                    draggable.addEventListener('dragend', (e) => e.target.classList.remove('dragging'));
                    bank.appendChild(draggable);
                });
            }

            // --- Drag and Drop ---
            function handleDrop(e) {
                e.preventDefault();
                const dropZone = e.target.closest('.drop-zone');
                if (!dropZone) return;

                const draggedAtomicNumber = parseInt(e.dataTransfer.getData('text/plain'));
                const dropZoneAtomicNumber = parseInt(dropZone.dataset.atomicNumber);
                const draggedElement = getElementByNumber(draggedAtomicNumber);

                if (draggedAtomicNumber === dropZoneAtomicNumber) {
                    dropZone.innerHTML = `<span class="element-number">${draggedElement.atomicNumber}</span><span class="element-symbol">${draggedElement.symbol}</span><span class="fun-fact-btn">✨</span>`;
                    dropZone.className = `drop-zone correct-drop ${draggedElement.category}`;
                    
                    dropZone.querySelector('.fun-fact-btn').addEventListener('click', () => getFunFact(draggedElement.name));

                    const draggableInBank = document.querySelector(`.draggable-element[data-atomic-number='${draggedAtomicNumber}']`);
                    if (draggableInBank) draggableInBank.classList.add('hidden');
                    
                    placedElements.add(draggedAtomicNumber);
                    dropZone.removeEventListener('drop', handleDrop);

                    score += 10;
                    updateScoreDisplay();
                    // checkAchievements logic here
                } else {
                    // Mistake logic here
                }
            }

            // --- Fun Fact Logic ---
            async function getFunFact(elementName) {
                funFactTitleEl.textContent = `Fact about ${elementName}`;
                funFactContentEl.innerHTML = '<div class="loader"></div>';
                funFactModal.classList.add('show');

                const prompt = `Tell me a surprising and fun fact about the element ${elementName}. Keep it to one or two interesting sentences.`;
                const fact = await callGemini(prompt);

                if (fact) {
                    funFactContentEl.textContent = fact;
                } else {
                    funFactContentEl.textContent = 'Could not fetch a fun fact at this time. Please try again later.';
                }
            }

            // --- Chem Lab Logic ---
            function setupChemLab() {
                const el1Select = document.getElementById('chem-lab-el1');
                const el2Select = document.getElementById('chem-lab-el2');
                el1Select.innerHTML = '<option value="">Select Element 1</option>';
                el2Select.innerHTML = '<option value="">Select Element 2</option>';
                chemLabResultEl.innerHTML = '';
                
                const sortedPlaced = [...placedElements].sort((a,b) => a - b);

                sortedPlaced.forEach(atomicNum => {
                    const el = getElementByNumber(atomicNum);
                    const option = `<option value="${el.name}">${el.name}</option>`;
                    el1Select.innerHTML += option;
                    el2Select.innerHTML += option;
                });
                chemLabModal.classList.add('show');
            }

            async function handleCombine() {
                const el1Name = document.getElementById('chem-lab-el1').value;
                const el2Name = document.getElementById('chem-lab-el2').value;

                if (!el1Name || !el2Name) {
                    chemLabResultEl.textContent = 'Please select two elements.';
                    return;
                }
                if (el1Name === el2Name) {
                    chemLabResultEl.textContent = 'Please select two different elements.';
                    return;
                }

                combineBtn.disabled = true;
                chemLabResultEl.innerHTML = '<div class="loader"></div>';
                
                const schema = {
                    type: "OBJECT",
                    properties: {
                        "reacts": { "type": "BOOLEAN" },
                        "compoundName": { "type": "STRING" },
                        "formula": { "type": "STRING" },
                        "funFact": { "type": "STRING" }
                    }
                };
                
                const prompt = `Do the elements ${el1Name} and ${el2Name} form a common, simple chemical compound? If yes, provide its common name, chemical formula, and a fun, one-sentence fact about it. If they don't typically react or form a common compound, set "reacts" to false and provide a brief explanation in the "funFact" field. Respond in this JSON schema: ${JSON.stringify(schema)}`;
                
                const resultText = await callGemini(prompt, true);
                
                if (resultText) {
                    try {
                        const resultJson = JSON.parse(resultText);
                        if (resultJson.reacts) {
                            chemLabResultEl.innerHTML = `<strong>Compound:</strong> ${resultJson.compoundName} (${resultJson.formula})<br><strong>Fact:</strong> ${resultJson.funFact}`;
                        } else {
                            chemLabResultEl.textContent = resultJson.funFact;
                        }
                    } catch (e) {
                        console.error("Failed to parse JSON from Gemini:", e);
                        chemLabResultEl.textContent = "Could not interpret the chemical reaction. Please try again.";
                    }
                } else {
                    chemLabResultEl.textContent = 'Failed to get a response. Please check your connection or API key.';
                }
                combineBtn.disabled = false;
            }

            // --- Utility Functions ---
            function getElementByNumber(num) { return fullElementsData.find(el => el.atomicNumber === num); }
            function getElementByPosition(period, group) { return fullElementsData.find(el => el.period === period && el.group === group); }
            function updateScoreDisplay() { scoreEl.textContent = score; }
            function initializeAchievements() { /* ... */ }

            // --- Event Listeners ---
            newBatchBtn.addEventListener('click', generateNewBatch);
            resetGameBtn.addEventListener('click', setupGame);
            openChemLabBtn.addEventListener('click', setupChemLab);
            closeChemLabBtn.addEventListener('click', () => chemLabModal.classList.remove('show'));
            closeFunFactBtn.addEventListener('click', () => funFactModal.classList.remove('show'));
            combineBtn.addEventListener('click', handleCombine);
            [chemLabModal, funFactModal].forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                    }
                });
            });

            // --- Initial Load ---
            setupGame();
        });
    </script>
</body>
</html>
